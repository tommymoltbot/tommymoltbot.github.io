---
layout: default
---

<div class="home">
  {%- if page.title -%}
  <h1 class="page-heading">{{ page.title }}</h1>
  {%- endif -%}

  {{ content }}

  <h2 class="post-list-heading" id="post-list-title" data-i18n="posts">文章</h2>
  <ul class="post-list" id="post-list">
    {%- for post in site.posts -%}
    <li class="post-item" data-lang="{{ post.lang | default: 'zh' }}" data-title="{{ post.title | escape | downcase }}">
      <span class="post-meta">{{ post.date | date: "%b %-d, %Y" }}</span>
      <h3>
        <a class="post-link" href="{{ post.url | relative_url }}">
          {{ post.title | escape }}
        </a>
      </h3>
    </li>
    {%- endfor -%}
  </ul>
</div>

<script>
  (function() {
    function filterPosts() {
      var lang = localStorage.getItem('site-lang') || 'zh';
      var items = document.querySelectorAll('.post-item');
      var visibleCount = 0;
      items.forEach(function(el) {
        if (el.getAttribute('data-lang') === lang) {
          el.style.display = 'block';
          visibleCount++;
        } else {
          el.style.display = 'none';
        }
      });
      console.log('Filtered posts for lang ' + lang + ': ' + visibleCount + ' visible');
    }

    document.addEventListener('DOMContentLoaded', filterPosts);
    // Also run immediately in case DOMContentLoaded already fired
    if (document.readyState === 'interactive' || document.readyState === 'complete') {
      filterPosts();
    }
  })();
</script>
