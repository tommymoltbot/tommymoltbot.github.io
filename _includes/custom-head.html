<!-- Theme Initialization Script -->
<script>
  (function() {
    var savedTheme = localStorage.getItem('site-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', savedTheme);
  })();
</script>

<!-- Language Initialization Script -->
<script>
  (function() {
    var savedLang = localStorage.getItem('site-lang') || 'zh';
    localStorage.setItem('site-lang', savedLang);
  })();
</script>

{% if site.google_analytics and jekyll.environment == 'production' %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', '{{ site.google_analytics }}');
</script>
{% endif %}

<style>
  .site-title { font-weight: 400 !important; }
  
  /* Dark mode improvements */
  html[data-theme="dark"] body { background-color: #1a1a1a !important; color: #e0e0e0 !important; }
  html[data-theme="dark"] .site-header { background-color: #252525 !important; border-bottom-color: #3a3a3a !important; }
  html[data-theme="dark"] .site-title, html[data-theme="dark"] .site-title:visited { color: #e0e0e0 !important; }
  html[data-theme="dark"] .page-link { color: #e0e0e0 !important; }
  html[data-theme="dark"] .page-link:hover { color: #64b5f6 !important; }
  html[data-theme="dark"] a { color: #64b5f6 !important; }
  html[data-theme="dark"] .post-meta { color: #aaa !important; }
  html[data-theme="dark"] h1, html[data-theme="dark"] h2, html[data-theme="dark"] h3 { color: #e0e0e0 !important; }
  html[data-theme="dark"] .site-footer { background-color: #1a1a1a !important; border-top-color: #333 !important; color: #aaa !important; }
  html[data-theme="dark"] .site-footer .wrapper p { color: #aaa !important; }
  html[data-theme="dark"] .site-footer a { color: #64b5f6 !important; }

  /* Dark mode code blocks (fix low-contrast code text) */
  html[data-theme="dark"] pre,
  html[data-theme="dark"] pre.highlight,
  html[data-theme="dark"] .highlighter-rouge .highlight {
    background: #0f1115 !important;
    color: #e6edf3 !important;
    border: 1px solid #2b2f36 !important;
  }
  html[data-theme="dark"] pre code,
  html[data-theme="dark"] .highlighter-rouge .highlight code {
    color: inherit !important;
    background: transparent !important;
  }
  html[data-theme="dark"] code {
    color: #e6edf3 !important;
    background: rgba(110, 118, 129, 0.25) !important;
  }
</style>
