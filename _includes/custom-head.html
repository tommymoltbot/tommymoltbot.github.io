<!-- Theme Initialization Script -->
<script>
  (function() {
    var savedTheme = localStorage.getItem('site-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', savedTheme);
  })();
</script>

<!-- Language Initialization Script -->
<script>
  (function() {
    document.documentElement.classList.add('site-loading');
    var savedLang = localStorage.getItem('site-lang') || 'zh';
    localStorage.setItem('site-lang', savedLang);
  })();
</script>

{% if site.google_analytics and jekyll.environment == 'production' %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', '{{ site.google_analytics }}');
</script>
{% endif %}

<style>
  .site-title { font-weight: 400 !important; }
  html.site-loading body { opacity: 0; }
  
  /* Dark mode */
  html[data-theme="dark"] body { background-color: #1a1a1a; color: #e0e0e0; }
  html[data-theme="dark"] .site-header { background-color: #252525; border-bottom-color: #3a3a3a; }
  html[data-theme="dark"] a { color: #64b5f6; }
  html[data-theme="dark"] .post-meta { color: #aaa; }
  html[data-theme="dark"] h1, html[data-theme="dark"] h2, html[data-theme="dark"] h3 { color: #e0e0e0; }
</style>
